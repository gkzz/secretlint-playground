name: Secretlint
# https://github.com/secretlint/secretlint/issues/166
on: [pull_request, workflow_dispatch]

# secretlint + git diff on Pull Request
# https://github.com/secretlint/secretlint

jobs:
  test:
    name: "Secretlint"
    runs-on: ubuntu-18.04
    steps:
      - name: checkout
        uses: actions/checkout@v2
      - uses: technote-space/get-diff-action@v4
      - name: run secretlint command on docker
        id: run-secretlint-command
        uses: addnab/docker-run-action@v3
        with:
          # https://hub.docker.com/r/secretlint/secretlint/tags
          image: secretlint/secretlint:v5.1.1
          # https://github.com/secretlint/secretlint#using-docker
          options: >
            -v ${{ github.workspace }}:${{ github.workspace }}
            -w=${{ github.workspace }}
            --rm
          run: secretlint ${{ env.GIT_DIFF_FILTERED }}
        if: env.GIT_DIFF && !env.MATCHED_FILES
      - name: echo stdout of secretlint
        if: success()
        run: echo ${{ steps.run-secretlint-command.outputs.stdout }}
      - name: echo stderr of secretlint
        if: failure()
        run: echo ${{ steps.run-secretlint-command.outputs.stderr }}
